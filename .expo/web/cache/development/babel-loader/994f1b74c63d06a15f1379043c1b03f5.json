{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport React from 'react';\nimport AppStyles from \"../styles/AppStyles\";\nimport { auth, db } from \"../firebase\";\nimport { collection, query, where, getDocs, writeBatch } from \"firebase/firestore\";\nimport { signOut, updatePassword, signInWithEmailAndPassword, deleteUser } from 'firebase/auth';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function ManageAccount(_ref) {\n  var navigation = _ref.navigation;\n\n  var _React$useState = React.useState(\"\"),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      newPassword = _React$useState2[0],\n      setNewPassword = _React$useState2[1];\n\n  var _React$useState3 = React.useState(\"\"),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      currentPassword = _React$useState4[0],\n      setCurrentPassword = _React$useState4[1];\n\n  var _React$useState5 = React.useState(\"\"),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      errorMessage = _React$useState6[0],\n      setErrorMessage = _React$useState6[1];\n\n  var logout = function logout() {\n    signOut(auth).then(function () {\n      navigation.popToTop();\n    });\n  };\n\n  var updateUserPassword = function updateUserPassword() {\n    signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword).then(function (userCredential) {\n      var user = userCredential.user;\n      updatePassword(user, newPassword).then(function () {\n        setNewPassword(\"\");\n        setErrorMessage(\"\");\n        setCurrentPassword(\"\");\n      }).catch(function (error) {\n        setErrorMessage(error.message);\n      });\n    }).catch(function (error) {\n      setErrorMessage(error.message);\n    });\n  };\n\n  var deleteUserAndToDos = function deleteUserAndToDos() {\n    if (currentPassword === \"\") {\n      setErrorMessage(\"Must enter current password to delete account\");\n    } else {\n      signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword).then(function (userCredential) {\n        var user = userCredential.user;\n        var batch = writeBatch(db);\n        var q = query(collection(db, \"todos\"), where(\"userId\", \"==\", user.uid));\n        getDocs(q).then(function (querySnapshot) {\n          querySnapshot.forEach(function (doc) {\n            batch.delete(doc.ref);\n          });\n          batch.commit();\n          deleteUser(user).then(function () {\n            navigation.popToTop();\n          }).catch(function (error) {\n            setErrorMessage(error.message);\n          });\n        });\n      }).catch(function (error) {\n        setErrorMessage(error.message);\n      });\n    }\n  };\n\n  return _jsxs(View, {\n    style: AppStyles.container,\n    children: [_jsx(Text, {\n      style: AppStyles.errorText,\n      children: errorMessage\n    }), _jsx(TextInput, {\n      style: [AppStyles.textInput, AppStyles.darkTextInput],\n      placeholder: \"Current Password\",\n      value: currentPassword,\n      secureTextEntry: true,\n      onChangeText: setCurrentPassword\n    }), _jsx(TextInput, {\n      style: [AppStyles.textInput, AppStyles.darkTextInput],\n      placeholder: \"New Password\",\n      value: newPassword,\n      secureTextEntry: true,\n      onChangeText: setNewPassword\n    }), _jsx(Button, {\n      title: \"Update Password\",\n      onPress: updateUserPassword\n    }), _jsx(Button, {\n      title: \"Delete User\",\n      onPress: deleteUserAndToDos\n    }), _jsx(Button, {\n      title: \"Logout\",\n      onPress: logout\n    }), _jsx(Button, {\n      title: \"Back to ToDos\",\n      onPress: function onPress() {\n        return navigation.pop();\n      }\n    })]\n  });\n}","map":{"version":3,"names":["React","AppStyles","auth","db","collection","query","where","getDocs","writeBatch","signOut","updatePassword","signInWithEmailAndPassword","deleteUser","ManageAccount","navigation","useState","newPassword","setNewPassword","currentPassword","setCurrentPassword","errorMessage","setErrorMessage","logout","then","popToTop","updateUserPassword","currentUser","email","userCredential","user","catch","error","message","deleteUserAndToDos","batch","q","uid","querySnapshot","forEach","doc","delete","ref","commit","container","errorText","textInput","darkTextInput","pop"],"sources":["D:/Desktop/ToDoApp/screens/ManageAccount.js"],"sourcesContent":["import { Button, View, TextInput, Text } from 'react-native';\r\nimport React from 'react';\r\nimport AppStyles from '../styles/AppStyles';\r\nimport { auth, db } from \"../firebase\";\r\nimport { collection, query, where, getDocs, writeBatch } from \"firebase/firestore\"; \r\nimport { signOut, updatePassword, signInWithEmailAndPassword, deleteUser } from 'firebase/auth';\r\n\r\nexport default function ManageAccount({ navigation }) {\r\n  let [newPassword, setNewPassword] = React.useState(\"\");\r\n  let [currentPassword, setCurrentPassword] = React.useState(\"\");\r\n  let [errorMessage, setErrorMessage] = React.useState(\"\");\r\n  let logout = () => {\r\n    signOut(auth).then(() => {\r\n      navigation.popToTop();\r\n    });\r\n  }\r\n\r\n  let updateUserPassword = () => {\r\n    signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword)\r\n      .then((userCredential) => {\r\n        const user = userCredential.user;\r\n        updatePassword(user, newPassword).then(() => {\r\n          setNewPassword(\"\");\r\n          setErrorMessage(\"\");\r\n          setCurrentPassword(\"\");\r\n        }).catch((error) => {\r\n          setErrorMessage(error.message);\r\n        });\r\n      })\r\n      .catch((error) => {\r\n        setErrorMessage(error.message);\r\n      });\r\n  };\r\n\r\n  let deleteUserAndToDos = () => {\r\n    if (currentPassword === \"\") {\r\n      setErrorMessage(\"Must enter current password to delete account\");\r\n    } else {\r\n      signInWithEmailAndPassword(auth, auth.currentUser.email, currentPassword)\r\n      .then((userCredential) => {\r\n        const user = userCredential.user;\r\n\r\n        // Get all todos for user and delete\r\n        let batch = writeBatch(db);\r\n        const q = query(collection(db, \"todos\"), where(\"userId\", \"==\", user.uid));\r\n        getDocs(q).then((querySnapshot) => {\r\n          querySnapshot.forEach((doc) => {\r\n            batch.delete(doc.ref);\r\n          });\r\n          batch.commit();\r\n  \r\n          deleteUser(user).then(() => {\r\n            navigation.popToTop();\r\n          }).catch((error) => {\r\n            setErrorMessage(error.message);\r\n          });\r\n        });\r\n      })\r\n      .catch((error) => {\r\n        setErrorMessage(error.message);\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <View style={AppStyles.container}>\r\n      <Text style={AppStyles.errorText}>{errorMessage}</Text>\r\n      <TextInput \r\n          style={[AppStyles.textInput, AppStyles.darkTextInput]} \r\n          placeholder='Current Password'\r\n          value={currentPassword}\r\n          secureTextEntry={true}\r\n          onChangeText={setCurrentPassword} />\r\n      <TextInput \r\n          style={[AppStyles.textInput, AppStyles.darkTextInput]} \r\n          placeholder='New Password'\r\n          value={newPassword}\r\n          secureTextEntry={true}\r\n          onChangeText={setNewPassword} />\r\n      <Button title=\"Update Password\" onPress={updateUserPassword} />\r\n      <Button title=\"Delete User\" onPress={deleteUserAndToDos} />\r\n      <Button title=\"Logout\" onPress={logout} />\r\n      <Button title=\"Back to ToDos\" onPress={() => navigation.pop()} />\r\n    </View>\r\n  );\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}